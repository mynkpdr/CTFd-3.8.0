{% extends "admin/base.html" %}

{% block content %}
<div class="jumbotron">
    <div class="container">
        <h1>Attempts Viewer</h1>
    </div>
</div>
<div class="container mt-5">
    <p>This plugin allows players to view their attempt history. <br> It adds:</p>
<ul>
    <li>An <strong>"Attempts"</strong> tab in the modal window of each challenge, displaying the team's attempts for that specific challenge.</li>
    <li>It also offers a <strong>"Your attempts history"</strong> button on the <a href="/challenges">challenges</a> page, allowing you to view all attempts made during the event (activate below).</li>
</ul>

<hr>
<br>
    <h4>Display settings:</h4>
    <form id="attempts-settings-form">
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="showMainButton">
            <label class="form-check-label" for="showMainButton">
                Show main button (Challenges page)
            </label>
        </div>
        <button type="submit" class="btn btn-primary mt-3">Save</button>
    </form>
    <div id="saveMessage" class="mt-3"></div>
</div>
<br><br> 
<footer>
  <p style="text-align: center;">
    <a href="https://hackolyte.fr/">
      <img src="https://hackolyte.fr/wp-content/uploads/2024/09/cropped-cropped-logo.png" alt="Hack'olyte logo" style="height: 30px; vertical-align: middle; margin-right: 5px;">
    </a>
    Plugin developed by the <a href="https://hackolyte.fr/">Hack'olyte</a> association - v1.3
  </p>
</footer>

<script>
document.getElementById("attempts-settings-form").addEventListener("submit", function (e) {
    e.preventDefault();
    const showMain = document.getElementById("showMainButton").checked;

    const csrfToken = window.init.csrfNonce;

    fetch('/attempts-viewer/admin/save', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'CSRF-Token': csrfToken
        },
        body: JSON.stringify({
            show_main_button: showMain
        })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            document.getElementById("saveMessage").innerHTML = "<span class='text-success'>Settings saved!</span>";
        } else {
            document.getElementById("saveMessage").innerHTML = "<span class='text-danger'>Error saving settings.</span>";
        }
    })
    .catch(() => {
        document.getElementById("saveMessage").innerHTML = "<span class='text-danger'>Network or server error.</span>";
    });
});

// Load current value on page open
fetch('/attempts-viewer/api/settings')
    .then(res => res.json())
    .then(configs => {
        document.getElementById("showMainButton").checked = configs.show_main_button;
    })
    .catch(() => {
        document.getElementById("showMainButton").checked = false;
    });
</script>
{% endblock %}
